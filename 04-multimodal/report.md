# Отчет о выполнении задания

## Проект и вариант
- **Название:** Telegram Bot — «Эксперт по кино»
- **Описание:** Асинхронный Telegram-бот, который ведет диалог с пользователем в роли кинокритика, поддерживает контекст и может анализировать изображения (постеры, кадры).
- **Вариант задания:** расширенный

## Реализованные возможности
- [x] Команды `/start`, `/help`, `/clear` с инициализацией и управлением историей
- [x] Интеграция с LLM через OpenRouter и модуль `LLMService`
- [x] Модульная архитектура: `handlers`, `services`, `storage`, `config`
- [x] Отдельная история диалога для каждого пользователя с ограничением длины
- [x] Загрузка системных промптов из файлов `prompts/`
- [x] Обработка изображений через vision-модель с подготовкой мультимодальных сообщений
- [x] Документация: обновленные `README.md` и `docs/vision.md`

## Технологический стек
- Python 3.10+
- uv (менеджер зависимостей)
- aiogram 3.x
- openai (AsyncOpenAI client) с `base_url` для OpenRouter
- Модели по умолчанию:
  - `openai/gpt-3.5-turbo` — текстовый диалог
  - `openai/gpt-4o-mini` — анализ изображений (можно заменить через `.env`)
- Дополнительно: python-dotenv, Makefile, in-memory storage

## Инструменты AI-driven разработки
- IDE: Cursor (с поддержкой GPT-5 Codex)
- Модели LLM в IDE: GPT-5 Codex, GPT-4o для генерации и правок кода, написания документации
- Использование: генерация шаблонов, рефакторинг, устранение ошибок, обновление документации

## Скриншоты работы
- [Диалог с ботом](screenshots/WhatsApp%20Image%202025-11-04%20at%2016.58.43.jpeg)
- [Ответ с анализом изображения](screenshots/WhatsApp%20Image%202025-11-11%20at%2022.55.29.jpeg)

## Облачный сервер
- Провайдер: Immers Cloud (VM `195.209.210.85`)
- GPU: NVIDIA Tesla T4 (подтверждено через `nvidia-smi`)
- Установленные модели Ollama: `qwen2.5:7b-instruct`, `llama3.2:1b`
- Настроены: Ollama API (`/v1` совместимый с OpenAI), открытый доступ через UFW

## Основные вызовы и решения
- **Конфигурация токенов** — добавлены проверки и обратная совместимость (`TELEGRAM_BOT_TOKEN` / `TELEGRAM_TOKEN`, `OPENROUTER_API_KEY` / `OPENAI_API_KEY`).
- **Смена функциональности** — удаление голосовой транскрибации: очищены сервисы, зависимости и документация, обновлены `.env` и `.env.example`.
- **Интеграция vision-модели** — реализован `ImageService` для скачивания, конвертации и формирования мультимодального контента; доработан `LLMService` с флагом `use_vision`.
- **Ошибки внешних API** — расширено логирование и сообщения об ошибках (включая рекомендации по моделям и конфигурации).
- **Развертывание на сервере** — настройка Ollama, загрузка моделей, проверка GPU и открытие удаленного доступа.

## Чему научился
- Настраивать modular-based aiogram бота с поддержкой мультимодальных сообщений.
- Упаковывать системные промпты в файлы и управлять ими через `.env`.
- Быстро адаптировать кодовую базу к новым требованиям (удаление целого функционального блока без регрессий).
- Настраивать Ollama с удаленным доступом и проверкой моделей через OpenAI-совместимый API.
- Использовать AI-IDE для итеративного рефакторинга и ведения технической документации.

