# Workflow разработки

Правила работы для code-ассистента при разработке бота по плану `tasklist.md`.

## Основные принципы

- **Строго по плану** — выполняем задачи по порядку из `tasklist.md`
- **Сначала согласуем** — потом реализуем
- **Одна итерация** — за один раз
- **Фиксируем прогресс** — обновляем задачи и коммитим

## Процесс работы

### 1. Начало работы

1. Открыть `docs/tasklist.md`
2. Найти первую незавершенную итерацию
3. Прочитать цель и задачи
4. Проверить критерии проверки

### 2. Согласование решения

Перед реализацией показывать пользователю:
- Какие изменения планируются
- Какой код будет изменен/создан
- Краткое объяснение подхода

**Формат:**
```
Итерация N: [название]

Планируемые изменения:
- Описание изменения 1
- Описание изменения 2

Код для изменения/добавления:
[отрезок кода]
```

Ждать подтверждения от пользователя перед реализацией.

### 3. Реализация

После согласования:
1. Внести изменения в код
2. Проверить на наличие ошибок линтера
3. Запустить проверку работоспособности (если применимо)
4. Подготовить summary изменений

**Формат:**
```
✅ Итерация N: выполнена

Изменения:
- Сделано 1
- Сделано 2

Проверка: [результат проверки]
```

### 4. Обновление прогресса

После реализации:
1. Открыть `docs/tasklist.md`
2. Отметить выполненные задачи `- [x]`
3. Если все задачи итерации выполнены:
   - Обновить таблицу прогресса
   - Изменить статус на ✅ Завершено
   - Указать прогресс 100%

### 5. Коммит изменений

После обновления прогресса:
1. Подготовить commit message
2. Сделать коммит с изменениями
3. Сообщить о коммите

**Формат commit message:**
```
feat: завершена итерация N - [название]

- Изменение 1
- Изменение 2
```

### 6. Переход к следующей итерации

Перед началом следующей итерации:
1. Показать пользователю summary завершенной итерации
2. Согласовать переход к следующей
3. Получить подтверждение
4. Начать следующий цикл с пункта 1

## Важные правила

### Согласование
- ❌ Не реализовывать без согласования
- ✅ Всегда показывать планируемый код
- ✅ Ждать подтверждения

### Масштаб изменений
- ✅ Одна итерация за раз
- ❌ Не перепрыгивать итерации
- ✅ Завершать полностью перед переходом

### Код
- ✅ Следовать `conventions.md`
- ✅ Применять KISS/YAGNI из `vision.md`
- ✅ Проверять линтером
- ✅ Логировать изменения

### Прогресс
- ✅ Отмечать задачи в `tasklist.md`
- ✅ Обновлять таблицу прогресса
- ✅ Делать коммит после каждой итерации

### Коммуникация
- ✅ Сообщать о каждом шаге
- ✅ Показывать результаты проверок
- ✅ Запрашивать подтверждение переходов

## Примеры

### Пример согласования

```
Итерация 1: Подготовка окружения

Планируемые изменения:
- Обновить pyproject.toml: заменить python-telegram-bot на aiogram 3.x
- Создать базовый класс FilmExpertBot в src/bot.py
- Настроить базовое логирование

Код для изменения:

pyproject.toml:
dependencies = [
    "openai>=1.0.0",
    "python-dotenv>=1.0.0",
    "aiogram>=3.0.0",  # изменено
]

src/bot.py:
[новый файл с базовой структурой]
```

### Пример завершения

```
✅ Итерация 1: выполнена

Изменения:
- Обновлен pyproject.toml на aiogram
- Создан класс FilmExpertBot
- Настроено логирование
- Установлены зависимости через make setup

Проверка: make setup завершился успешно, импорты работают

Готово к коммиту. Продолжить?
```

## Критерии успеха

Итерация считается завершенной, если:
- ✅ Все задачи из итерации выполнены
- ✅ Код проверен линтером без ошибок
- ✅ Критерий проверки выполнен (если есть)
- ✅ Прогресс обновлен в tasklist.md
- ✅ Сделан коммит

## Исключения

Если нужно отклониться от плана:
1. Объяснить причину
2. Согласовать изменения с пользователем
3. Обновить plan при необходимости
4. Зафиксировать изменения

## Заключение

Следовать этому workflow для каждой итерации из `tasklist.md`.
Не пропускать шаги согласования и подтверждения.
Всегда обновлять прогресс и делать коммиты.

